# ===== ZSH Configuration - Complete Setup =====
# Save this to ~/.zshrc

# ===== Oh My Zsh Installation =====
# If not installed, run: sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

export ZSH="$HOME/.oh-my-zsh"

# ===== Theme =====
ZSH_THEME="robbyrussell"  # Options: agnoster, powerlevel10k/powerlevel10k, robbyrussell, jonathan

# ===== Plugins =====
plugins=(
    git
    zsh-autosuggestions
    zsh-syntax-highlighting
    web-search
    colored-man-pages
    colorize
    extract
    z
    sudo
    copypath
    copyfile
    jsontools
)

source $ZSH/oh-my-zsh.sh

# ===== Path Configuration =====
export PATH="/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$PATH"
export PATH="$HOME/bin:$PATH"
export PATH="/opt/homebrew/bin:$PATH"  # For Apple Silicon Macs

# Node/NPM
export PATH="$HOME/.npm-global/bin:$PATH"

# Python
export PATH="$HOME/Library/Python/3.11/bin:$PATH"

# Go
export GOPATH="$HOME/go"
export PATH="$GOPATH/bin:$PATH"

# ===== Environment Variables =====
export EDITOR="vim"
export VISUAL="vim"
export LANG="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"

# History settings
HISTSIZE=10000
SAVEHIST=10000
HISTFILE=~/.zsh_history
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_FIND_NO_DUPS
setopt SHARE_HISTORY
setopt APPEND_HISTORY

# ===== Aliases - General =====
alias zshconfig="$EDITOR ~/.zshrc"
alias ohmyzsh="$EDITOR ~/.oh-my-zsh"
alias reload="source ~/.zshrc"

# Navigation
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .....="cd ../../../.."
alias ~="cd ~"
alias -- -="cd -"

# List files
alias ls="ls -G"  # Colorize
alias ll="ls -lah"
alias la="ls -A"
alias l="ls -CF"
alias lt="ls -lhtrA"  # Sort by date

# File operations
alias cp="cp -iv"
alias mv="mv -iv"
alias rm="rm -iv"
alias mkdir="mkdir -pv"

# System
alias c="clear"
alias h="history"
alias j="jobs -l"
alias path='echo -e ${PATH//:/\\n}'
alias now='date +"%T"'
alias nowdate='date +"%d-%m-%Y"'

# ===== Aliases - Development =====
# Git
alias g="git"
alias gs="git status"
alias ga="git add"
alias gaa="git add --all"
alias gc="git commit -m"
alias gp="git push"
alias gpl="git pull"
alias gco="git checkout"
alias gb="git branch"
alias gl="git log --oneline --graph --decorate --all"
alias gd="git diff"
alias gds="git diff --staged"
alias gstash="git stash"
alias gpop="git stash pop"

# Docker
alias d="docker"
alias dc="docker-compose"
alias dps="docker ps"
alias dpa="docker ps -a"
alias di="docker images"
alias dex="docker exec -it"
alias dlog="docker logs -f"
alias dstop="docker stop $(docker ps -q)"
alias drm="docker rm $(docker ps -aq)"
alias drmi="docker rmi $(docker images -q)"

# Python
alias py="python3"
alias pip="pip3"
alias venv="python3 -m venv"
alias activate="source venv/bin/activate"

# Node/NPM
alias ni="npm install"
alias nid="npm install --save-dev"
alias nig="npm install -g"
alias nr="npm run"
alias ns="npm start"
alias nt="npm test"
alias nb="npm run build"

# Yarn
alias y="yarn"
alias ya="yarn add"
alias yad="yarn add --dev"
alias yr="yarn run"
alias ys="yarn start"
alias yb="yarn build"

# ===== Custom Functions =====

# Create and enter directory
mkd() {
    mkdir -p "$@" && cd "$_"
}

# Extract any archive
extract() {
    if [ -f $1 ]; then
        case $1 in
            *.tar.bz2)   tar xjf $1     ;;
            *.tar.gz)    tar xzf $1     ;;
            *.bz2)       bunzip2 $1     ;;
            *.rar)       unrar e $1     ;;
            *.gz)        gunzip $1      ;;
            *.tar)       tar xf $1      ;;
            *.tbz2)      tar xjf $1     ;;
            *.tgz)       tar xzf $1     ;;
            *.zip)       unzip $1       ;;
            *.Z)         uncompress $1  ;;
            *.7z)        7z x $1        ;;
            *)           echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# Find file by name
ff() {
    find . -type f -iname "*$1*"
}

# Find directory by name
fd() {
    find . -type d -iname "*$1*"
}

# Grep through files
grepf() {
    grep -r -i "$1" .
}

# Get public IP
myip() {
    curl -s https://api.ipify.org
    echo
}

# Get local IP
localip() {
    ipconfig getifaddr en0
}

# Weather
weather() {
    curl -s "wttr.in/${1:-Stockholm}?format=3"
}

# Create a backup of a file
backup() {
    cp "$1" "$1.backup-$(date +%Y%m%d-%H%M%S)"
}

# Git: Create branch and switch to it
gcb() {
    git checkout -b "$1"
}

# Git: Delete branch locally and remotely
gbd() {
    git branch -d "$1"
    git push origin --delete "$1"
}

# Kill process on port
killport() {
    lsof -ti:$1 | xargs kill -9
}

# Quick server
serve() {
    python3 -m http.server ${1:-8000}
}

# Open in VS Code
code() {
    if [ $# -eq 0 ]; then
        command code .
    else
        command code "$@"
    fi
}

# Show disk usage of current directory
usage() {
    du -sh * | sort -hr | head -20
}

# Quick notes
note() {
    echo "$(date): $*" >> "$HOME/notes.txt"
}

notes() {
    cat "$HOME/notes.txt"
}

# Process management
psgrep() {
    ps aux | grep -v grep | grep -i -e VSZ -e "$1"
}

# HTTP methods shortcuts
for method in GET HEAD POST PUT DELETE TRACE OPTIONS; do
    alias "$method"="lwp-request -m '$method'"
done

# Quick math
calc() {
    echo "$*" | bc -l
}

# Update everything
update() {
    echo "Updating Homebrew..."
    brew update && brew upgrade && brew cleanup
    
    if command -v npm &> /dev/null; then
        echo "\nUpdating npm packages..."
        npm update -g
    fi
    
    echo "\nUpdating Oh My Zsh..."
    omz update
}

# ===== Autocompletions =====
autoload -Uz compinit
compinit

# Case-insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'

# Menu selection
zstyle ':completion:*' menu select

# ===== Key Bindings =====
bindkey '^[[A' history-search-backward
bindkey '^[[B' history-search-forward

# ===== FZF (Fuzzy Finder) =====
# Install with: brew install fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'

# ===== Welcome Message =====
echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘      Zsh Configuration Loaded!        â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ’¡ Tip of the day: Use 'll' for detailed listing"
echo ""

# ===== Additional Tools Installation Commands =====
# Run these in terminal to enhance your setup:
#
# Oh My Zsh plugins:
# git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
# git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
#
# Homebrew essentials:
# brew install fzf bat exa ripgrep fd htop tree
#
# Better alternatives:
# alias cat='bat'
# alias ls='exa --icons'
# alias find='fd'
# alias grep='rg'
